<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>文章内容编辑</title>
</head>
<script type="text/javascript" src="../wangEditor/release/wangEditor.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<link rel="stylesheet" type="text/css" href="../wangEditor/release/wangEditor.min.css">
<link rel="stylesheet" href="../css/edite.css">
<body>
    <div class="outcontet">
        <div>
            <span>请选择发表文章类型：</span>
            <select name="" id="selectType">
                <option value="news">校园快讯</option>
                <option value="notice">通知公告</option>     
            </select>
        </div>
        <div>
            <span>请输入文章标题：</span>
            <input class="getTitle" type="text"/>
        </div>
        
        <div id="editor"></div>
        <ul class="contentList">
            
        </ul>
    </div>
    
    <div class="buttons">
        <!--<button id="btn1">销毁编辑器</button>
        <button id="btn2">恢复编辑器</button>
        <button id="btn3">追加内容</button>-->
        <button id="btn4">清空内容</button>
        <button id="btn5">保存内容</button>
    </div>
    
</body>
<script>
    var editor = new wangEditor('#editor');
    editor.customConfig.onchange = function (html) {
        // 监控变化
        console.log(html)
    }
    //上传图片
    editor.customConfig.uploadImgServer = '/upload'
    // 设置 headers（举例）
    
    // 关闭粘贴样式的过滤
    editor.customConfig.pasteFilterStyle = false
    editor.customConfig.pasteTextHandle = function (content) {
        // content 即粘贴过来的内容（html 或 纯文本），可进行自定义处理然后返回
        return content + ''
    }
    // 上传图片接口
    // editor.customConfig.uploadImgServer = '/upload'
    // 使用 base64 保存图片
    //editor.customConfig.uploadImgShowBase64 = true  
    // 限制上传图片大小为3M 
    //editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024
    editor.create();
    console.log( $('.w-e-text-container'))
    $('.w-e-text-container').attr('height','500px');
    $('#btn1').click(function () {
        // 禁用编辑器
        editor.$textElem.attr('contenteditable', false)
    });

    $('#btn2').click(function () {
        // 开启编辑器
        editor.$textElem.attr('contenteditable', true)
        
    });
    $('#btn3').click(function () {
        // 创建编辑器之后继续追加内容
        editor.txt.append('<p>追加的内容</p>')
    });
    $('#btn4').click(function () {
        // 创建编辑器之后继续追加内容
        editor.txt.html('');
    });
    $('#btn5').click(function () {
        // 创建编辑器之后继续追加内容
        var title = $('.getTitle').val();
        if(!title){
            alert('请输入文章标题');
            return;
        }
        if(editor.txt.html()=='<p><br></p>'){
            alert('请输入文章内容');
            return;
        }
        $.ajax({
            url:'/addContent',
            type:'post',
            data:{data:JSON.stringify({
                    type:$('#selectType').val(),
                    title: $('.getTitle').val(),
                    content:editor.txt.html()
                })
            },
            success:function(res){
                if(res=='ok'){
                    alert('保存数据成功');
                    getdatalist();
                    $('.getTitle').val('')
                    editor.txt.html('')
                }
            }
        })
    });
    //获取文档数据
    function getdatalist(){
        $.ajax({
            url:'/getContent',
            type:'get',
            dataType:'json',
            success:function(res){
                var contentListOne = '<li class="title"><b>校园快讯</b></li>';
                res.news&&res.news.map(function(item){
                    contentListOne += '<li class="title">'+item.title+"<span class='deleteData' type='news'>删除</span></li>"
                })
                var contentListTwo = '<li class="title next"><b>通知公告</b></li>';
                res.notice&&res.notice.map(function(item){
                    contentListTwo += '<li class="title">'+item.title+"<span class='deleteData' type='notice'>删除</span></li>"
                })
                console.log(contentListOne+contentListTwo)
                $('.contentList').html(contentListOne+contentListTwo);
            }
        })
    }
    $('.contentList').on('click','.deleteData',function(){
        $.ajax({
            url:'/deleteData',
            type:'get',
            dataType:'json',
            data:{
                type:$(this).attr('type'),
                title:$(this).parent().text().replace('删除','')
            },
            success:function(res){
                getdatalist();
            },
            error:function(err){
                console.log(err)
                getdatalist();
            }

        })
    })
    getdatalist();
    
    // 初始化编辑器的内容
    editor.txt.html('');
    // 调整编辑器的层级，默认是1000
    editor.customConfig.zIndex = 100
   
</script>
</html>